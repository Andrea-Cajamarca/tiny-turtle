<!DOCTYPE html>
<meta charset="utf-8">
<title>TinyTurtle Lab</title>
<link href="lab/lab.css" rel="stylesheet">
<style>
* {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}

html {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: smaller;
}

a {
  color: inherit;
}

a:hover {
  background: yellow;
}

footer {
  text-align: center;
  font-size: smaller;
}
</style>
<h1>TinyTurtle Lab</h1>
<div id="labs"></div>
<footer>
  [ <a href="http://github.com/toolness/tiny-turtle" target="_blank">GitHub</a>
    | <a id="togetherjs" href="#">Invite a Friend</a>
  ]
</footer>
<script id="sample" type="javascript/sample-code">
function box(length) {
  for (var i = 0; i < 4; i++) {
    forward(length);
    right(90);
  }
}

penStyle = 'purple';
box(90);
left(10);
box(80);
left(10);
box(70);
stamp();
</script>
<script src="tiny-turtle.js"></script>
<script src="lab/validation.js"></script>
<script src="lab/vendor/png-baker.js"></script>
<script src="lab/lab.js"></script>
<script>
var $ = document.querySelector.bind(document);

function initLab(id, defaultContent) {
  var lab = new Lab();

  lab.code.value = sessionStorage[id] || defaultContent;
  lab.el.setAttribute('id', id);
  $('#labs').appendChild(lab.el);
  lab.render();
  window.addEventListener('unload', function() {
    sessionStorage[id] = lab.code.value;
  }, false);
}

function initLabs() {
  var panes = parseInt((location.search.match(/panes=([1-9])/) || [0,1])[1]);
  var sampleCode = $("#sample").textContent.trim();

  for (var i = 0; i < panes; i++)
    initLab('tinyturtle-lab-' + i, i == 0 ? sampleCode : '');
}

$("#togetherjs").addEventListener('click', function(e) {
  e.preventDefault();
  TogetherJS(this);
}, false);

initLabs();
</script>
<script async src="https://togetherjs.com/togetherjs-min.js"></script>
